#livestream #http #api 
# 视频录制文件在哪里可以找到？

结合文档`观摩配置说明文档`，已经将`EasyDarwin`流媒体服务程序部署在了服务器端，拿到服务器端的IP（例如10.0.0.5），通过`10.0.0.5:10086`，在浏览器中访问流媒体服务提供的web管理页面。

![[image-20241031171428719.png]]

用户名和密码都是`admin`，登录进去。

在`直播服务-录像管理`选项卡中可以查看所有曾经推流视频的缓存。

![[image-20241031171545426.png]]

这些缓存都在服务器端的磁盘中，位置在`EasyDarwin.exe`的目录下

![[image-20241031171702588.png]]

视频缓存文件在`data/record`相对目录下，

![[image-20241031171743217.png]]

可以看到这些文件夹和web管理页面中的缓存视频的名称是一一对应的。

再进入其中的文件夹，多进几个目录，能找到缓存文件`*.m3u8`和N个`*.ts`视频切片文件。

![[image-20241031171859833.png]]

# 流媒体服务器的配置项在哪里修改？

如果需要修改缓存文件，找到`EasyDarwin.ini`文件，其中有配置项的说明，包含但不限于修改存储路径、端口号、数据库配置等

​![[image-20241031172118346.png]]

# EasyDarwin接口文档

其提供了apidoc接口文档，例如没有修改配置的情况下，服务器的端口10086，通过`http://127.0.0.1:10086/apidoc中的api相对路径`这种形式去调用api

例如登录接口：
接口文档描述如下：
![[Pasted image 20241102110814.png]]

其所需的密码是经过md5加密的，已知密码明文是admin，找个在线md5加密网站转换一道，得到如下结果：
![[Pasted image 20241102115002.png]]
发送请求格式如下：
![[Pasted image 20241102115021.png]]

拿到`token`后，其余的接口调用时，在`Auth`中设置`Bearer Token`，然后再按照easydarwin的接口文档进行接口请求调用，就可以拿到返回结果了。例如调用`按日查询设备所有录像`的接口：
![[Pasted image 20241102115210.png]]

我此前推流的设备的`id`是`931fb5763978fafa4b58e1f6af07e3f3`，日期是`20241102`，可从easydarwin管理页面证明：
![[Pasted image 20241102115312.png]]

然后我在`ApiFox`中的请求如下：
![[Pasted image 20241102115424.png]]
先在Auth中填入第一个登录认证接口返回的token，然后再请求：
![[Pasted image 20241102115509.png]]
可以看到其中的`start_time`即为本地的磁盘目录对应的文件夹名

如果获取到的`list`为空数组，则说明没有对应的录制回放视频。

# 录制回放数据结构定义

在UE中，开始推流时会记录开始的时间戳，结束推流时会记录结束的时间戳，同时将本次演练的所有录制信息以json格式，将文件上传至服务器。文件上传走的此前对接好的接口，`fileOwner`参数值给的是`6`，数据结构定义如下：

```json
{
  "name": "演练项目名",
  "start_time": "20241102144414",
  "end_time": "20241102144528",
  "user_data": [
    {
      "player_id": "803fc2e398bf04d1d71998ef7aa19e2a",
      "name": "王五",
      "role": "导调员",
      "team": ""
    },
    {
      "player_id": "b807dbb2f70247ff4825daaf88c5bbde",
      "name": "郑十",
      "role": "医疗员",
      "team": "1号分站"
    },
    {
      "player_id": "42347a484d257fd9213daae0869be2d8",
      "name": "赵六",
      "role": "消防员",
      "team": "1号分站"
    }
  ]
}
```

每次演练都是生成一个类似上述结构的json文件上传至服务器。每个文件中包含的数据为本次演练的名称、起止时间以及各个端的推流id、名称、角色信息。

又因EasyDarwin有一个接口是：
![[Pasted image 20241102152910.png]]

可以通过给定的json文件中的数据，拼装录像播放的url进行回放，例如：

![[Pasted image 20241102153030.png]]

建议在拼装录像播放的url前先通过前文所述的`按日查询设备所有录像`接口，判断是否有录像，没有则不要显示在UI界面上。