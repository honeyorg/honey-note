
# 前置条件

将程序包中的推流软件，拷贝到一个新的目录，并在电脑上设置该目录的环境变量。
推流软件在`软件包`中，是一个压缩包，找一个目录进行解压，例如：`D:/Program Files`，解压后如下：
![[Pasted image 20241107181424.png]]

复制`bin`目录的绝对路径，如图：
![[Pasted image 20241107181504.png]]

然后设置系统环境变量，可以在开始菜单中搜索`环境变量`，选择`编辑系统环境变量`，如图：
![[Pasted image 20241107174649.png]]

在弹出窗口中选择`环境变量`，如图：
![[Pasted image 20241107174730.png]]

找到`系统变量`下的`Path`，如图：
![[Pasted image 20241107175412.png]]

双击后弹窗中，点击`新建`，然后将目录粘贴进去，点击确定，如图：

![[Pasted image 20241107181600.png]]

之后把之前所有弹窗都点击`确定`关闭即可。

然后打开`cmd`，输入`ffmpeg`，敲回车，看是否能检测到推流软件，如图：

![[Pasted image 20241107181701.png]]

说明该推流软件已部署成功

# 推流配置项说明

在UE程序包的`Plugins/OnionClient/Config/OnionConfig.json`文件中，有如下几个配置项：

```json
  "videoRecordPath": "/admin-api/guangzhou/video-record/create",
  "liveStreamHostname": "127.0.0.1",
  "liveStreamPort": 10035,
  "liveStreamPrefix": "live",
  "liveStreamParams": {
    "fps": 24,
    "preset": "veryfast",
    "maxrate": "1000k",
    "bufsize": "2000k",
    "gopsize": 50,
    "res": "1280x720",
    "aspect": "16:9"
  }
```

- `videoRecordPath`：此项是每次结束演练时向后端发送录像回放数据的接口地址，如后端无修改则此项不用修改
- `liveStreamHostname`：此项是部署的流媒体服务器的IP地址
- `liveStreamPrefix`：此项不要修改
- `liveStreamParams`：此项是推流的一些配置项
  - `fps`：帧率
  - `preset`：编码器预设，可以填`ultrafast`、`veryfast`、`fast`、`medium`、`slow`，越往后的参数会导致视频体积越大
  - `maxrate`：最大比特率，数值越大视频体积越大质量越高
  - `bufsize`：缓冲区尺寸，不建议修改
  - `gopsize`：关键帧间隔，数值越小，视频体积越大，但是回放时在视频播放器中跳转到某时刻更精准
  - `res`：分辨率，默认是720p的
  - `aspect`：宽高比，注意此项，如果是单屏机器，填`16:9`，像驾驶模拟器这种三屏设备，填`48:9`，这样可以保证视频不会被拉伸，能保证画面保持原有的宽高比

